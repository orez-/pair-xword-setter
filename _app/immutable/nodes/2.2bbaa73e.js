import{s as je,f as L,a as Q,l as K,g as M,h as O,d as p,c as Y,m as G,j as I,k as xt,i as B,x as S,A as oe,B as x,y as be,C as ge,D as ue,E as ut,o as ft,e as Ne,n as re,p as at,F as se,G as zt,H as dt,I as _t,J as Ht}from"../chunks/scheduler.dc23dc69.js";import{S as Le,i as Me,b as We,d as Be,m as qe,a as xe,t as ze,e as He}from"../chunks/index.df494a3a.js";import{b as ht}from"../chunks/paths.bdff6f1f.js";const Kt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function te(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}let Z;const ne=new Array(32).fill(void 0);ne.push(void 0,null,!0,!1);function P(t){return ne[t]}let he=ne.length;function Gt(t){t<36||(ne[t]=he,he=t)}function me(t){const e=P(t);return Gt(t),e}const wt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});wt.decode();let pe=new Uint8Array;function we(){return pe.byteLength===0&&(pe=new Uint8Array(Z.memory.buffer)),pe}function Ie(t,e){return wt.decode(we().subarray(t,t+e))}function z(t){he===ne.length&&ne.push(ne.length+1);const e=he;return he=ne[e],ne[e]=t,e}let ke=0;const ve=new TextEncoder("utf-8"),Jt=typeof ve.encodeInto=="function"?function(t,e){return ve.encodeInto(t,e)}:function(t,e){const n=ve.encode(t);return e.set(n),{read:t.length,written:n.length}};function Ke(t,e,n){if(n===void 0){const c=ve.encode(t),f=e(c.length);return we().subarray(f,f+c.length).set(c),ke=c.length,f}let l=t.length,r=e(l);const o=we();let s=0;for(;s<l;s++){const c=t.charCodeAt(s);if(c>127)break;o[r+s]=c}if(s!==l){s!==0&&(t=t.slice(s)),r=n(r,l,l=s+t.length*3);const c=we().subarray(r+s,r+l),f=Jt(t,c);s+=f.written}return ke=s,r}function Ce(t){return t==null}let ye=new Int32Array;function le(){return ye.byteLength===0&&(ye=new Int32Array(Z.memory.buffer)),ye}let Ae=new Float64Array;function Xt(){return Ae.byteLength===0&&(Ae=new Float64Array(Z.memory.buffer)),Ae}function Pe(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const r=t.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=t.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(t)){const r=t.length;let o="[";r>0&&(o+=Pe(t[0]));for(let s=1;s<r;s++)o+=", "+Pe(t[s]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let l;if(n.length>1)l=n[1];else return toString.call(t);if(l=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:l}function Zt(t,e){return we().subarray(t/1,t/1+e)}function Qt(t){try{const s=Z.__wbindgen_add_to_stack_pointer(-16);Z.generate_puz(s,z(t));var e=le()[s/4+0],n=le()[s/4+1],l=le()[s/4+2],r=le()[s/4+3];if(r)throw me(l);var o=Zt(e,n).slice();return Z.__wbindgen_free(e,n*1),o}finally{Z.__wbindgen_add_to_stack_pointer(16)}}function De(t,e){try{return t.apply(this,e)}catch(n){Z.__wbindgen_exn_store(z(n))}}async function Yt(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(l){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",l);else throw l}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function $t(){const t={};return t.wbg={},t.wbg.__wbindgen_object_drop_ref=function(e){me(e)},t.wbg.__wbindgen_is_string=function(e){return typeof P(e)=="string"},t.wbg.__wbindgen_error_new=function(e,n){const l=new Error(Ie(e,n));return z(l)},t.wbg.__wbindgen_string_get=function(e,n){const l=P(n),r=typeof l=="string"?l:void 0;var o=Ce(r)?0:Ke(r,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=ke;le()[e/4+1]=s,le()[e/4+0]=o},t.wbg.__wbindgen_is_object=function(e){const n=P(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return P(e)===void 0},t.wbg.__wbindgen_in=function(e,n){return P(e)in P(n)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=P(e);return z(n)},t.wbg.__wbindgen_string_new=function(e,n){const l=Ie(e,n);return z(l)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return P(e)==P(n)},t.wbg.__wbindgen_boolean_get=function(e){const n=P(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_number_get=function(e,n){const l=P(n),r=typeof l=="number"?l:void 0;Xt()[e/8+1]=Ce(r)?0:r,le()[e/4+0]=!Ce(r)},t.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,n){const l=P(e)[P(n)];return z(l)},t.wbg.__wbg_set_20cbc34131e76824=function(e,n,l){P(e)[me(n)]=me(l)},t.wbg.__wbg_get_57245cc7d7c7619d=function(e,n){const l=P(e)[n>>>0];return z(l)},t.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return P(e).length},t.wbg.__wbindgen_is_function=function(e){return typeof P(e)=="function"},t.wbg.__wbg_new_268f7b7dd3430798=function(){return z(new Map)},t.wbg.__wbg_next_579e583d33566a86=function(e){const n=P(e).next;return z(n)},t.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return De(function(e){const n=P(e).next();return z(n)},arguments)},t.wbg.__wbg_done_1b73b0672e15f234=function(e){return P(e).done},t.wbg.__wbg_value_1ccc36bc03462d71=function(e){const n=P(e).value;return z(n)},t.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return z(Symbol.iterator)},t.wbg.__wbg_get_765201544a2b6869=function(){return De(function(e,n){const l=Reflect.get(P(e),P(n));return z(l)},arguments)},t.wbg.__wbg_call_97ae9d8645dc388b=function(){return De(function(e,n){const l=P(e).call(P(n));return z(l)},arguments)},t.wbg.__wbg_new_0b9bfdd97583284e=function(){const e=new Object;return z(e)},t.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(P(e))},t.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let n;try{n=P(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_set_933729cf5b66ac11=function(e,n,l){const r=P(e).set(P(n),P(l));return z(r)},t.wbg.__wbg_isSafeInteger_dfa0593e8d7ac35a=function(e){return Number.isSafeInteger(P(e))},t.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const n=P(e).buffer;return z(n)},t.wbg.__wbg_new_8c3f0052272a457a=function(e){const n=new Uint8Array(P(e));return z(n)},t.wbg.__wbg_set_83db9690f9353e79=function(e,n,l){P(e).set(P(n),l>>>0)},t.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return P(e).length},t.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let n;try{n=P(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_debug_string=function(e,n){const l=Pe(P(n)),r=Ke(l,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=ke;le()[e/4+1]=o,le()[e/4+0]=r},t.wbg.__wbindgen_throw=function(e,n){throw new Error(Ie(e,n))},t.wbg.__wbindgen_memory=function(){const e=Z.memory;return z(e)},t}function en(t,e){return Z=t.exports,bt.__wbindgen_wasm_module=e,Ae=new Float64Array,ye=new Int32Array,pe=new Uint8Array,Z}async function bt(t){typeof t>"u"&&(t=new URL(""+new URL("../assets/xword_puz_bg.2a440b26.wasm",import.meta.url).href,self.location));const e=$t();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:l}=await Yt(await t,e);return en(n,l)}const gt=(t,e)=>{let n=[];for(let l=0;l<t.length;l+=e){const r=t.substring(l,l+e);n.push(r)}return n},tn=(t,e)=>t.reduce((n,l,r)=>{let o=e(l,r);return o!=null&&n.push(o),n},[]),nn=t=>(e,n)=>{const l=t(e),r=t(n);for(let o=0;o<l.length;o++){if(l[o]<r[o])return-1;if(l[o]>r[o])return 1}return 0};const{window:ln}=Kt;function Ge(t,e,n){const l=t.slice();return l[55]=e[n],l[57]=n,l}function Je(t,e,n){const l=t.slice();l[55]=e[n],l[63]=n;const r=N*l[57]+l[63];l[58]=r;const o=l[2][l[58]];l[59]=o;const s=l[4].get(l[58]);l[60]=s;const c=l[1]&&l[1].x==l[63]&&l[1].y==l[57];return l[61]=c,l}function Xe(t){let e;return{c(){e=K(" Selected")},l(n){e=G(n," Selected")},m(n,l){B(n,e,l)},d(n){n&&p(e)}}}function Ze(t){let e,n=t[59].number+"",l;return{c(){e=L("span"),l=K(n),this.h()},l(r){e=M(r,"SPAN",{class:!0});var o=O(e);l=G(o,n),o.forEach(p),this.h()},h(){I(e,"class","cell-number svelte-1b3j7e7")},m(r,o){B(r,e,o),S(e,l)},p(r,o){o[0]&4&&n!==(n=r[59].number+"")&&re(l,n)},d(r){r&&p(e)}}}function rn(t){let e,n=t[59].fill+"",l;return{c(){e=L("span"),l=K(n),this.h()},l(r){e=M(r,"SPAN",{class:!0});var o=O(e);l=G(o,n),o.forEach(p),this.h()},h(){I(e,"class","cell-fill svelte-1b3j7e7")},m(r,o){B(r,e,o),S(e,l)},p(r,o){o[0]&4&&n!==(n=r[59].fill+"")&&re(l,n)},d(r){r&&p(e)}}}function sn(t){let e,n=t[60]+"",l;return{c(){e=L("span"),l=K(n),this.h()},l(r){e=M(r,"SPAN",{class:!0});var o=O(e);l=G(o,n),o.forEach(p),this.h()},h(){I(e,"class","cell-fill preview svelte-1b3j7e7")},m(r,o){B(r,e,o),S(e,l)},p(r,o){o[0]&16&&n!==(n=r[60]+"")&&re(l,n)},d(r){r&&p(e)}}}function Qe(t){let e,n,l,r,o,s=t[59].number&&Ze(t);function c(k,v){return!k[59].fill&&k[60]?sn:rn}let f=c(t),d=f(t);function b(...k){return t[28](t[63],t[57],...k)}function D(...k){return t[29](t[63],t[57],...k)}function j(...k){return t[30](t[63],t[57],...k)}return{c(){e=L("div"),s&&s.c(),n=Q(),d.c(),l=Q(),this.h()},l(k){e=M(k,"DIV",{class:!0});var v=O(e);s&&s.l(v),n=Y(v),d.l(v),l=Y(v),v.forEach(p),this.h()},h(){I(e,"class","cell svelte-1b3j7e7"),se(e,"selected-area",t[15](t[1],t[63],t[57])),se(e,"selected",t[61]),se(e,"wall",t[59].wall),se(e,"error",t[59].fill.length>0&&t[59].fill.length<t[0])},m(k,v){B(k,e,v),s&&s.m(e,null),S(e,n),d.m(e,null),S(e,l),r||(o=[x(e,"mousedown",b),x(e,"mouseover",D),x(e,"contextmenu",j)],r=!0)},p(k,v){t=k,t[59].number?s?s.p(t,v):(s=Ze(t),s.c(),s.m(e,n)):s&&(s.d(1),s=null),f===(f=c(t))&&d?d.p(t,v):(d.d(1),d=f(t),d&&(d.c(),d.m(e,l))),v[0]&32770&&se(e,"selected-area",t[15](t[1],t[63],t[57])),v[0]&2&&se(e,"selected",t[61]),v[0]&4&&se(e,"wall",t[59].wall),v[0]&5&&se(e,"error",t[59].fill.length>0&&t[59].fill.length<t[0])},d(k){k&&p(e),s&&s.d(),d.d(),r=!1,ue(o)}}}function Ye(t){let e,n=te({length:N}),l=[];for(let r=0;r<n.length;r+=1)l[r]=Qe(Je(t,n,r));return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=Ne()},l(r){for(let o=0;o<l.length;o+=1)l[o].l(r);e=Ne()},m(r,o){for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(r,o);B(r,e,o)},p(r,o){if(o[0]&47127){n=te({length:N});let s;for(s=0;s<n.length;s+=1){const c=Je(r,n,s);l[s]?l[s].p(c,o):(l[s]=Qe(c),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&p(e),ge(l,r)}}}function $e(t){let e,n,l=t[8].number+"",r,o,s,c,f,d,b,D,j=t[7].number+"",k,v,i,a,C,_,h;return{c(){e=L("div"),n=L("label"),r=K(l),o=K("A"),s=Q(),c=L("div"),f=L("input"),d=Q(),b=L("div"),D=L("label"),k=K(j),v=K("D"),i=Q(),a=L("div"),C=L("input"),this.h()},l(g){e=M(g,"DIV",{class:!0});var F=O(e);n=M(F,"LABEL",{for:!0,class:!0});var w=O(n);r=G(w,l),o=G(w,"A"),w.forEach(p),s=Y(F),c=M(F,"DIV",{class:!0});var E=O(c);f=M(E,"INPUT",{id:!0,class:!0,type:!0}),E.forEach(p),F.forEach(p),d=Y(g),b=M(g,"DIV",{class:!0});var y=O(b);D=M(y,"LABEL",{for:!0,class:!0});var T=O(D);k=G(T,j),v=G(T,"D"),T.forEach(p),i=Y(y),a=M(y,"DIV",{class:!0});var J=O(a);C=M(J,"INPUT",{id:!0,class:!0,type:!0}),J.forEach(p),y.forEach(p),this.h()},h(){I(n,"for","across-clue"),I(n,"class","svelte-1b3j7e7"),I(f,"id","across-clue"),I(f,"class","fill-width svelte-1b3j7e7"),I(f,"type","text"),I(c,"class","flex-container svelte-1b3j7e7"),I(e,"class","clue svelte-1b3j7e7"),I(D,"for","down-clue"),I(D,"class","svelte-1b3j7e7"),I(C,"id","down-clue"),I(C,"class","fill-width svelte-1b3j7e7"),I(C,"type","text"),I(a,"class","flex-container svelte-1b3j7e7"),I(b,"class","clue svelte-1b3j7e7")},m(g,F){B(g,e,F),S(e,n),S(n,r),S(n,o),S(e,s),S(e,c),S(c,f),oe(f,t[8].acrossClue),B(g,d,F),B(g,b,F),S(b,D),S(D,k),S(D,v),S(b,i),S(b,a),S(a,C),oe(C,t[7].downClue),_||(h=[x(f,"input",t[32]),x(C,"input",t[33])],_=!0)},p(g,F){F[0]&256&&l!==(l=g[8].number+"")&&re(r,l),F[0]&256&&f.value!==g[8].acrossClue&&oe(f,g[8].acrossClue),F[0]&128&&j!==(j=g[7].number+"")&&re(k,j),F[0]&128&&C.value!==g[7].downClue&&oe(C,g[7].downClue)},d(g){g&&(p(e),p(d),p(b)),_=!1,ue(h)}}}function on(t){let e,n,l,r,o,s,c,f,d,b,D,j,k,v,i,a,C,_=t[9]&&Xe(),h=te({length:ie}),g=[];for(let w=0;w<h.length;w+=1)g[w]=Ye(Ge(t,h,w));let F=t[10]&&$e(t);return{c(){e=L("div"),n=L("div"),l=L("div"),r=L("div"),o=L("input"),s=Q(),c=L("div"),f=K("by "),d=L("input"),b=Q(),D=L("button"),j=K("Export"),_&&_.c(),k=Q(),v=L("div");for(let w=0;w<g.length;w+=1)g[w].c();i=Q(),F&&F.c(),this.h()},l(w){e=M(w,"DIV",{id:!0,class:!0});var E=O(e);n=M(E,"DIV",{class:!0});var y=O(n);l=M(y,"DIV",{class:!0});var T=O(l);r=M(T,"DIV",{class:!0});var J=O(r);o=M(J,"INPUT",{class:!0,type:!0}),J.forEach(p),s=Y(T),c=M(T,"DIV",{class:!0});var fe=O(c);f=G(fe,"by "),d=M(fe,"INPUT",{class:!0,type:!0}),fe.forEach(p),T.forEach(p),b=Y(y),D=M(y,"BUTTON",{class:!0});var ae=O(D);j=G(ae,"Export"),_&&_.l(ae),ae.forEach(p),y.forEach(p),k=Y(E),v=M(E,"DIV",{id:!0,tabindex:!0,style:!0,class:!0});var de=O(v);for(let _e=0;_e<g.length;_e+=1)g[_e].l(de);de.forEach(p),i=Y(E),F&&F.l(E),E.forEach(p),this.h()},h(){I(o,"class","title fill-width svelte-1b3j7e7"),I(o,"type","text"),I(r,"class","flex-container svelte-1b3j7e7"),I(d,"class","fill-width svelte-1b3j7e7"),I(d,"type","text"),I(c,"class","flex-container svelte-1b3j7e7"),I(l,"class","meta svelte-1b3j7e7"),I(D,"class","svelte-1b3j7e7"),I(n,"class","header"),I(v,"id","grid"),I(v,"tabindex","0"),xt(v,"grid-template-columns","repeat("+N+", 1fr)"),I(v,"class","svelte-1b3j7e7"),I(e,"id","grid-wrapper"),I(e,"class","svelte-1b3j7e7")},m(w,E){B(w,e,E),S(e,n),S(n,l),S(l,r),S(r,o),oe(o,t[5]),S(l,s),S(l,c),S(c,f),S(c,d),oe(d,t[6]),S(n,b),S(n,D),S(D,j),_&&_.m(D,null),S(e,k),S(e,v);for(let y=0;y<g.length;y+=1)g[y]&&g[y].m(v,null);t[31](v),S(e,i),F&&F.m(e,null),a||(C=[x(ln,"mouseup",t[25]),x(o,"input",t[26]),x(d,"input",t[27]),x(D,"click",t[16]),x(v,"keydown",t[14]),x(v,"contextmenu",cn)],a=!0)},p(w,E){if(E[0]&32&&o.value!==w[5]&&oe(o,w[5]),E[0]&64&&d.value!==w[6]&&oe(d,w[6]),w[9]?_||(_=Xe(),_.c(),_.m(D,null)):_&&(_.d(1),_=null),E[0]&47127){h=te({length:ie});let y;for(y=0;y<h.length;y+=1){const T=Ge(w,h,y);g[y]?g[y].p(T,E):(g[y]=Ye(T),g[y].c(),g[y].m(v,null))}for(;y<g.length;y+=1)g[y].d(1);g.length=h.length}w[10]?F?F.p(w,E):(F=$e(w),F.c(),F.m(e,null)):F&&(F.d(1),F=null)},i:be,o:be,d(w){w&&p(e),_&&_.d(),ge(g,w),t[31](null),F&&F.d(),a=!1,ue(C)}}}const ie=20,N=20,cn=t=>t.preventDefault();function un(t,e,n){let l,r,o,s,c,{cellFillLen:f}=e;const d=u=>gt(u,f),b=ut();let D,j=new Map,k="Untitled",v="Anonymous",i=null,a=Array(N*ie).fill(null).map(()=>({wall:!1,fill:"",number:null,downClue:null,acrossClue:null}));const C=u=>{n(1,i={x:u.x,y:u.y,x2:u.x,y2:u.y}),_()},_=()=>{if(!i)return;let u=i.y*N+i.x;b("update",{downPattern:E(i),acrossPattern:w(i),cell:a[u]})},h=u=>({x:A,y:m,...R})=>u({x:A,y:m,...R,front:0,back:a.length,step:N}),g=u=>({x:A,y:m,...R})=>{const V=m*N;return u({x:A,y:m,...R,front:V,back:V+N,step:1})},F=({front:u,back:A,step:m,x:R,y:V})=>{let W=-1,U=V*N+R;if(a[U].wall)return null;for(;U>=u&&!a[U].wall;U-=m)W++;const $=U+m,q=[];for(U=$;U<A&&!a[U].wall;U+=m){const ee=a[U].fill;(!ee.length||ee.length==f)&&q.push(ee)}return{pattern:q,index:W}},w=g(F),E=h(F),y=({front:u,back:A,step:m,x:R,y:V,word:H,pivotIdx:W})=>{let U=V*N+R-W*m;u<=U-m&&(n(2,a[U-m].fill="",a),n(2,a[U-m].wall=!0,a));for(const $ of d(H))n(2,a[U].fill=$,a),n(2,a[U].wall=!1,a),U+=m;U<A&&(n(2,a[U].fill="",a),n(2,a[U].wall=!0,a)),D.focus(),Se(),_()},T=g(y),J=h(y),fe=({...u})=>T({...i,...u}),ae=({...u})=>J({...i,...u}),de=({front:u,step:A,x:m,y:R,grid:V})=>{if(m==null||R==null)return{};let H=m+N*R;if(!V[H])return null;for(;H>=u&&!V[H].wall;H-=A);return V[H+A]},_e=g(de),vt=h(de),Ue=({front:u,back:A,step:m,x:R,y:V,word:H,pivotIdx:W})=>{let U=V*N+R-W*m;j.clear();for(const $ of d(H))j.set(U,$),U+=m;n(4,j)},yt=g(Ue),At=h(Ue),kt=({...u})=>yt({...i,...u}),Ft=({...u})=>At({...i,...u}),St=u=>{let A=i.y*N+i.x;j.clear(),j.set(A,u),n(4,j)},Et=()=>{j.clear(),n(4,j)},It=u=>{let A=i.y*N+i.x;n(2,a[A].wall=!1,a),n(2,a[A].fill=u,a),D.focus(),_()},Re=(u,A,m)=>{u.preventDefault();const R=m*N+A;n(2,a[R].wall^=!0,a),a[R].wall&&n(2,a[R].fill="",a),Se(),_()},Te=(u,A,m)=>{let R=1;const V=({idx:W,topBounded:U,leftBounded:$})=>{const q=u[W],ee=U||$;q.number=null,U?q.downClue??(q.downClue=""):q.downClue=null,$?q.acrossClue??(q.acrossClue=""):q.acrossClue=null,!q.wall&&ee&&(q.number=R,R++)};let H=!0;for(let W=0;W<A;W++)V({idx:W,topBounded:!0,leftBounded:H}),H=u[W].wall;for(let W=1;W<m;W++){const U=W*A,$=u[U-A].wall;V({idx:U,topBounded:$,leftBounded:!0});for(let q=1;q<A;q++){const ee=U+q,Ve=u[ee-A].wall,X=u[ee-1].wall;V({idx:ee,topBounded:Ve,leftBounded:X})}}},Se=()=>Te(a,N,ie),Oe=({event:u,x:A,y:m})=>{u.buttons!=1||(i==null?void 0:i.state)!=="area"||(n(1,i.x2=A,i),n(1,i.y2=m,i))},Ct=u=>{switch(u.keyCode){case 37:u.preventDefault(),i&&i.x>0&&C({x:i.x-1,y:i.y});break;case 38:u.preventDefault(),i&&i.y>0&&C({x:i.x,y:i.y-1});break;case 39:u.preventDefault(),i&&i.x<N-1&&C({x:i.x+1,y:i.y});break;case 40:u.preventDefault(),i&&i.y<ie-1&&C({x:i.x,y:i.y+1});break;case 8:if(!i)return;const A=i.y*N+i.x;a[A].fill.length?(n(2,a[A].fill="",a),_()):i.x!=0&&!a[A-1].wall&&C({x:i.x-1,y:i.y});break;default:if(!i||u.ctrlKey||u.altKey||u.metaKey)return;if(u.keyCode>64&&u.keyCode<91){const m=String.fromCharCode(u.keyCode),R=i.y*N+i.x;if(a[R].wall)return;a[R].fill.length<f&&(n(2,a[R].fill+=m,a),_())}}},Dt=(u,A,m)=>{if(!u)return!1;const R=Math.min(u.x,u.x2),V=Math.max(u.x,u.x2),H=Math.min(u.y,u.y2),W=Math.max(u.y,u.y2);return R<=A&&A<=V&&H<=m&&m<=W},Pt=(u,A)=>{const m=document.createElement("a");m.href=u,m.download=A,document.body.appendChild(m),m.style.display="none",m.click(),m.remove()},jt=(u,A,m)=>{const R=new Blob([u],{type:m}),V=window.URL.createObjectURL(R);Pt(V,A),setTimeout(()=>window.URL.revokeObjectURL(V),1e3)},Lt=()=>{let u,A,m,R;o?(u=Math.min(i.x,i.x2),A=Math.max(i.x,i.x2),m=Math.min(i.y,i.y2),R=Math.max(i.y,i.y2)):(u=0,m=0,A=N-1,R=ie-1);const V=[],H=R-m+1,W=A-u+1;for(let X=m;X<=R;X++)for(let Ee=u;Ee<=A;Ee++){const qt=X*N+Ee;V.push({...a[qt]})}Te(V,H,W);const U=[],$=[];for(const X of V)X.acrossClue!=null&&U.push([X.number,X.acrossClue]),X.downClue!=null&&$.push([X.number,X.downClue]);const q=V.map(X=>X.wall?null:X.fill),ee=Qt({width:H,height:W,grid:q,acrossClues:U,downClues:$,title:k,author:v});jt(ee,`${k||"Untitled"}.puz`,"application/octet-stream")};Se(),ft(async()=>{await bt()});const Mt=()=>i&&n(1,i.state=null,i);function Ut(){k=this.value,n(5,k)}function Rt(){v=this.value,n(6,v)}const Tt=(u,A,m)=>{m.buttons===1&&(C({x:u,y:A}),n(1,i.state="area",i))},Ot=(u,A,m)=>Oe({event:m,x:u,y:A}),Vt=(u,A,m)=>Re(m,u,A);function Nt(u){at[u?"unshift":"push"](()=>{D=u,n(3,D)})}function Wt(){s.acrossClue=this.value,n(8,s),n(1,i),n(2,a)}function Bt(){c.downClue=this.value,n(7,c),n(1,i),n(2,a)}return t.$$set=u=>{"cellFillLen"in u&&n(0,f=u.cellFillLen)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(24,l=i&&a[i.x+i.y*N]),t.$$.dirty[0]&16777216&&n(10,r=l&&!l.wall),t.$$.dirty[0]&2&&n(9,o=i&&(i.x!=i.x2||i.y!=i.y2)),t.$$.dirty[0]&6&&n(8,s=_e({...i,grid:a})),t.$$.dirty[0]&6&&n(7,c=vt({...i,grid:a}))},[f,i,a,D,j,k,v,c,s,o,r,C,Re,Oe,Ct,Dt,Lt,fe,ae,kt,Ft,St,Et,It,l,Mt,Ut,Rt,Tt,Ot,Vt,Nt,Wt,Bt]}class fn extends Le{constructor(e){super(),Me(this,e,un,on,je,{cellFillLen:0,setAcrossFillAtSelected:17,setDownFillAtSelected:18,setPreviewAcrossAtSelected:19,setPreviewDownAtSelected:20,setPreviewAtSelected:21,clearPreview:22,setFillAtSelected:23},null,[-1,-1,-1])}get setAcrossFillAtSelected(){return this.$$.ctx[17]}get setDownFillAtSelected(){return this.$$.ctx[18]}get setPreviewAcrossAtSelected(){return this.$$.ctx[19]}get setPreviewDownAtSelected(){return this.$$.ctx[20]}get setPreviewAtSelected(){return this.$$.ctx[21]}get clearPreview(){return this.$$.ctx[22]}get setFillAtSelected(){return this.$$.ctx[23]}}function et(t,e,n){const l=t.slice();return l[16]=e[n],l}function tt(t,e,n){const l=t.slice();return l[19]=e[n],l}function nt(t,e,n){const l=t.slice();return l[19]=e[n],l}function an(t){let e,n=`<img class="spinner svelte-1q31v9d" src="${ht}/spinner.gif" alt="loading fill suggestions"/>`;return{c(){e=L("div"),e.innerHTML=n,this.h()},l(l){e=M(l,"DIV",{class:!0,"data-svelte-h":!0}),zt(e)!=="svelte-y52rrk"&&(e.innerHTML=n),this.h()},h(){I(e,"class","spinner-container svelte-1q31v9d")},m(l,r){B(l,e,r)},p:be,d(l){l&&p(e)}}}function dn(t){var h,g,F;let e,n,l=(((h=t[1])==null?void 0:h.length)??"?")+"",r,o,s,c,f=(((g=t[2])==null?void 0:g.length)??"?")+"",d,b,D,j,k=(((F=t[3])==null?void 0:F.length)??"?")+"",v,i,a=t[1]&&lt(t),C=t[2]&&st(t),_=t[3]&&it(t);return{c(){e=L("ul"),n=L("li"),r=K(l),o=K(` potential across fills.
        `),a&&a.c(),s=Q(),c=L("li"),d=K(f),b=K(` potential down fills.
        `),C&&C.c(),D=Q(),j=L("li"),v=K(k),i=K(` potential fills for this cell:
        `),_&&_.c()},l(w){e=M(w,"UL",{});var E=O(e);n=M(E,"LI",{});var y=O(n);r=G(y,l),o=G(y,` potential across fills.
        `),a&&a.l(y),y.forEach(p),s=Y(E),c=M(E,"LI",{});var T=O(c);d=G(T,f),b=G(T,` potential down fills.
        `),C&&C.l(T),T.forEach(p),D=Y(E),j=M(E,"LI",{});var J=O(j);v=G(J,k),i=G(J,` potential fills for this cell:
        `),_&&_.l(J),J.forEach(p),E.forEach(p)},m(w,E){B(w,e,E),S(e,n),S(n,r),S(n,o),a&&a.m(n,null),S(e,s),S(e,c),S(c,d),S(c,b),C&&C.m(c,null),S(e,D),S(e,j),S(j,v),S(j,i),_&&_.m(j,null)},p(w,E){var y,T,J;E&2&&l!==(l=(((y=w[1])==null?void 0:y.length)??"?")+"")&&re(r,l),w[1]?a?a.p(w,E):(a=lt(w),a.c(),a.m(n,null)):a&&(a.d(1),a=null),E&4&&f!==(f=(((T=w[2])==null?void 0:T.length)??"?")+"")&&re(d,f),w[2]?C?C.p(w,E):(C=st(w),C.c(),C.m(c,null)):C&&(C.d(1),C=null),E&8&&k!==(k=(((J=w[3])==null?void 0:J.length)??"?")+"")&&re(v,k),w[3]?_?_.p(w,E):(_=it(w),_.c(),_.m(j,null)):_&&(_.d(1),_=null)},d(w){w&&p(e),a&&a.d(),C&&C.d(),_&&_.d()}}}function lt(t){let e,n=te(t[1].slice(0,Fe)),l=[];for(let r=0;r<n.length;r+=1)l[r]=rt(nt(t,n,r));return{c(){e=L("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=M(r,"DIV",{class:!0});var o=O(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(p),this.h()},h(){I(e,"class","word-grid svelte-1q31v9d")},m(r,o){B(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&50){n=te(r[1].slice(0,Fe));let s;for(s=0;s<n.length;s+=1){const c=nt(r,n,s);l[s]?l[s].p(c,o):(l[s]=rt(c),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&p(e),ge(l,r)}}}function rt(t){let e,n,l=t[5](t[19])+"",r,o,s;function c(){return t[7](t[19])}function f(){return t[8](t[19])}return{c(){e=L("a"),n=new dt(!1),r=Q(),this.h()},l(d){e=M(d,"A",{class:!0});var b=O(e);n=_t(b,!1),r=Y(b),b.forEach(p),this.h()},h(){n.a=r,I(e,"class","svelte-1q31v9d")},m(d,b){B(d,e,b),n.m(l,e),S(e,r),o||(s=[x(e,"click",c),x(e,"mouseover",f),x(e,"mouseout",t[9])],o=!0)},p(d,b){t=d,b&2&&l!==(l=t[5](t[19])+"")&&n.p(l)},d(d){d&&p(e),o=!1,ue(s)}}}function st(t){let e,n=te(t[2].slice(0,Fe)),l=[];for(let r=0;r<n.length;r+=1)l[r]=ot(tt(t,n,r));return{c(){e=L("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=M(r,"DIV",{class:!0});var o=O(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(p),this.h()},h(){I(e,"class","word-grid svelte-1q31v9d")},m(r,o){B(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&52){n=te(r[2].slice(0,Fe));let s;for(s=0;s<n.length;s+=1){const c=tt(r,n,s);l[s]?l[s].p(c,o):(l[s]=ot(c),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&p(e),ge(l,r)}}}function ot(t){let e,n,l=t[5](t[19])+"",r,o,s;function c(){return t[10](t[19])}function f(){return t[11](t[19])}return{c(){e=L("a"),n=new dt(!1),r=Q(),this.h()},l(d){e=M(d,"A",{class:!0});var b=O(e);n=_t(b,!1),r=Y(b),b.forEach(p),this.h()},h(){n.a=r,I(e,"class","svelte-1q31v9d")},m(d,b){B(d,e,b),n.m(l,e),S(e,r),o||(s=[x(e,"click",c),x(e,"mouseover",f),x(e,"mouseout",t[12])],o=!0)},p(d,b){t=d,b&4&&l!==(l=t[5](t[19])+"")&&n.p(l)},d(d){d&&p(e),o=!1,ue(s)}}}function it(t){let e,n=te(t[3]),l=[];for(let r=0;r<n.length;r+=1)l[r]=ct(et(t,n,r));return{c(){e=L("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=M(r,"DIV",{class:!0});var o=O(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(p),this.h()},h(){I(e,"class","letter-grid svelte-1q31v9d")},m(r,o){B(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&24){n=te(r[3]);let s;for(s=0;s<n.length;s+=1){const c=et(r,n,s);l[s]?l[s].p(c,o):(l[s]=ct(c),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&p(e),ge(l,r)}}}function ct(t){let e,n=t[16]+"",l,r,o;function s(){return t[13](t[16])}function c(){return t[14](t[16])}return{c(){e=L("a"),l=K(n),this.h()},l(f){e=M(f,"A",{class:!0});var d=O(e);l=G(d,n),d.forEach(p),this.h()},h(){I(e,"class","svelte-1q31v9d")},m(f,d){B(f,e,d),S(e,l),r||(o=[x(e,"click",s),x(e,"mouseover",c),x(e,"mouseout",t[15])],r=!0)},p(f,d){t=f,d&8&&n!==(n=t[16]+"")&&re(l,n)},d(f){f&&p(e),r=!1,ue(o)}}}function _n(t){let e;function n(o,s){return o[0]?dn:an}let l=n(t),r=l(t);return{c(){e=L("div"),r.c(),this.h()},l(o){e=M(o,"DIV",{id:!0,class:!0});var s=O(e);r.l(s),s.forEach(p),this.h()},h(){I(e,"id","cell-data"),I(e,"class","svelte-1q31v9d")},m(o,s){B(o,e,s),r.m(e,null)},p(o,[s]){l===(l=n(o))&&r?r.p(o,s):(r.d(1),r=l(o),r&&(r.c(),r.m(e,null)))},i:be,o:be,d(o){o&&p(e),r.d()}}}const Fe=100;function hn(t,e,n){let{dict:l}=e,{acrossFills:r}=e,{downFills:o}=e,{cellFills:s}=e,{cellFillLen:c}=e;const f=ut(),d=({entry:h,pivotIdx:g})=>{const F=g*c,w=F+c,E=h.word.slice(0,F),y=h.word.slice(F,w),T=h.word.slice(w);return`${E}<strong>${y}</strong>${T}`},b=h=>f("fillAcross",{word:h.entry.word,pivotIdx:h.pivotIdx}),D=h=>f("previewAcross",{word:h.entry.word,pivotIdx:h.pivotIdx}),j=()=>f("clearPreview"),k=h=>f("fillDown",{word:h.entry.word,pivotIdx:h.pivotIdx}),v=h=>f("previewDown",{word:h.entry.word,pivotIdx:h.pivotIdx}),i=()=>f("clearPreview"),a=h=>f("fillCell",{fill:h}),C=h=>f("previewCell",{fill:h}),_=()=>f("clearPreview");return t.$$set=h=>{"dict"in h&&n(0,l=h.dict),"acrossFills"in h&&n(1,r=h.acrossFills),"downFills"in h&&n(2,o=h.downFills),"cellFills"in h&&n(3,s=h.cellFills),"cellFillLen"in h&&n(6,c=h.cellFillLen)},[l,r,o,s,f,d,c,b,D,j,k,v,i,a,C,_]}class wn extends Le{constructor(e){super(),Me(this,e,hn,_n,je,{dict:0,acrossFills:1,downFills:2,cellFills:3,cellFillLen:6})}}const mt=2,pt=t=>gt(t,mt),bn=async()=>{const e=await(await fetch(`${ht}/dict/words.txt`)).text(),n=tn(e.split(`
`),mn),l=new Map;for(const r of n){const o=r.chunks;delete r.chunks;for(const s of o){const c=l.get(s)||[];c.push(r),l.set(s,c)}}return{entries:n,chunkIndex:l,filterFit:gn}};function gn(t,e){let n=[],l=new Set;const r=s=>{let c=t[s],f=this.chunkIndex.get(c)||[];for(const d of f){const b=pt(d.word);for(const[D,j]of b.entries())if(j==c){const k=s-D,v=k+b.length,i=e-k;if(i<0||i>=b.length)continue;const a=b[i];if(k<0||k>0&&t[k-1]||v>t.length||v<t.length&&t[v]||!b.every((_,h)=>{const g=t[k+h];return!g||g==_}))continue;n.push({entry:d,pivotIdx:i}),l.add(a)}}};if(t[e])r(e);else{for(let s=e;s>=0;s--)if(t[s]){r(s);break}for(let s=e;s<t.length;s++)if(t[s]){r(s);break}}n.sort(nn(s=>[-s.entry.score,s.entry.word,s.pivotIdx]));let o=null;return n=n.reduce((s,c)=>(o&&c.pivotIdx==o.pivotIdx&&c.entry==o.entry||(s.push(c),o=c),s),[]),{gridFills:n,cellFills:l}}const mn=t=>{let[e,n]=t.split(";");if(!e.match(`^([A-Z]{${mt}})+$`))return null;const l=new Set(pt(e));return n=+n,{word:e,score:n,chunks:l}};function pn(t){let e,n,l,r,o,s,c={cellFillLen:ce};return l=new fn({props:c}),t[6](l),l.$on("update",t[5]),o=new wn({props:{dict:t[1],downFills:t[2],acrossFills:t[3],cellFills:t[4],cellFillLen:ce}}),o.$on("fillAcross",t[7]),o.$on("fillDown",t[8]),o.$on("fillCell",t[9]),o.$on("previewAcross",t[10]),o.$on("previewDown",t[11]),o.$on("previewCell",t[12]),o.$on("clearPreview",t[13]),{c(){e=Q(),n=L("div"),We(l.$$.fragment),r=Q(),We(o.$$.fragment),this.h()},l(f){Ht("svelte-ckbzzi",document.head).forEach(p),e=Y(f),n=M(f,"DIV",{id:!0,class:!0});var b=O(n);Be(l.$$.fragment,b),r=Y(b),Be(o.$$.fragment,b),b.forEach(p),this.h()},h(){document.title="Pair XWord Setter",I(n,"id","body-wrapper"),I(n,"class","svelte-i647o8")},m(f,d){B(f,e,d),B(f,n,d),qe(l,n,null),S(n,r),qe(o,n,null),s=!0},p(f,[d]){const b={};l.$set(b);const D={};d&2&&(D.dict=f[1]),d&4&&(D.downFills=f[2]),d&8&&(D.acrossFills=f[3]),d&16&&(D.cellFills=f[4]),o.$set(D)},i(f){s||(xe(l.$$.fragment,f),xe(o.$$.fragment,f),s=!0)},o(f){ze(l.$$.fragment,f),ze(o.$$.fragment,f),s=!1},d(f){f&&(p(e),p(n)),t[6](null),He(l),He(o)}}}const ce=2;function vn(t,e,n){let l,r=null,o=null,s=null,c=null;ft(async()=>{n(1,r=await bn())});const f=(_,h)=>{if(!_||!h)return _||h;let g=new Set;for(const F of h)_.has(F)&&g.add(F);return g},d=_=>{var F;if(l.clearPreview(),(F=_.detail.cell)!=null&&F.wall){n(2,o=null),n(3,s=null),n(4,c=null);return}let h;const g=({pattern:w,index:E})=>{if(w.some(y=>y)){const{gridFills:y,cellFills:T}=r.filterFit(w,E);return h=f(h,T),y}return null};n(2,o=g(_.detail.downPattern)),n(3,s=g(_.detail.acrossPattern)),n(2,o=o==null?void 0:o.filter(({entry:w,pivotIdx:E})=>{let y=E*ce,T=w.word.slice(y,y+ce);return h.has(T)})),n(3,s=s==null?void 0:s.filter(({entry:w,pivotIdx:E})=>{let y=E*ce,T=w.word.slice(y,y+ce);return h.has(T)})),h!=null?(n(4,c=[...h]),c.sort()):n(4,c=null)};function b(_){at[_?"unshift":"push"](()=>{l=_,n(0,l)})}return[l,r,o,s,c,d,b,_=>l.setAcrossFillAtSelected(_.detail),_=>l.setDownFillAtSelected(_.detail),_=>l.setFillAtSelected(_.detail.fill),_=>l.setPreviewAcrossAtSelected(_.detail),_=>l.setPreviewDownAtSelected(_.detail),_=>l.setPreviewAtSelected(_.detail.fill),_=>l.clearPreview()]}class Fn extends Le{constructor(e){super(),Me(this,e,vn,pn,je,{})}}export{Fn as component};
